Java Memory Model （Java 内存模型）是 Java 定义的一组开发规范，用于描述程序在并发环境下的内存**可见性**和**有序性**行为，关注的是如何管理和协调多线程环境中**共享变量**的访问。

## 基础概念

`JMM`：**Java Memory Model** ，屏蔽各种硬件和操作系统的内存访问差异，实现跨平台的一致内存访问效果。主要抽象出 Java 程序中的线程如何与共享内存进行交互，以及定义了程序中对共享变量的访问规则。

关于JMM，我们首先要知道的是JMM被提出来的作用以及该模型抽象出来的概念。

**JMM 提出的目的**是为了屏蔽各种硬件和操作系统的内存访问差异，为 Java 程序员提供一个一致的、多平台适用的并发内存访问模型而无需考虑底层的实现。

Java 内存模型抽象出了线程和共享内存之间关系，在 Java 内存模型（JMM）中，所有线程共享的变量存储在共享内存（主内存）中，线程在操作这些变量时，会首先将它们从主内存拷贝到自己的本地内存（工作内存）中进行修改。修改后的值不会立即写回共享内存，除非通过同步机制（如 `volatile` 或 `synchronized`）将本地内存中的更新强制回写到主内存，从而保证其他线程能够看到最新的修改。JMM 通过这种模型解决了线程之间的内存可见性和一致性问题。

`共享内存（主内存）`：共享变量（也称为主内存）是 JMM 中线程之间**共享变量**的存储区域。Java 中所有的**实例变量**、**类变量**都存储在主内存中。所有线程都可以读取和写入共享内存中的变量，但由于线程有自己的本地内存，线程对共享变量的修改不一定会立即对其他线程可见。在硬件层面，共享内存通常对应于计算机的物理内存（RAM）。

`本地内存（工作内存）`：本地内存是被**抽象**出来的概念，用来描述每个线程独有的内存区域，实际上不是真实存在的，是对线程在硬件层面缓存机制的抽象，包括寄存器、CPU缓存、写缓存冲区等。这个抽象概念的目的是帮助理解线程对共享变量的操作在多线程环境下**如何影响内存的可见性和一致性**。

![Java线程与本地内存和共享内存的关系](/JMM.png)

## JMM 与 JVM 和硬件的关系

JMM 作为一个抽象模型，定义了 Java 程序中的线程如何与共享内存进行交互，以确保一致性和可见性。这个模型在实际运行时，需要依赖底层硬件（如 CPU、缓存、内存）和 JVM 的协作来实现。硬件提供了基本的并发原语，而 JVM 负责将这些抽象的 JMM 规则映射到具体的硬件指令上。

### 

